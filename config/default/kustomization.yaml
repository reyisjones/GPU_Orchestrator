apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Adds namespace, RBAC and Deployment.
resources:
- ../crd
- ../rbac
- ../manager

# [CERT] To enable cert-manager, uncomment all sections with [CERT] markers.
# Uncomment this section for cert-manager (v1.7.1 or latest).
# patches:
# - target:
#     group: admissionregistration.k8s.io
#     version: v1
#     kind: ValidatingWebhookConfiguration
#     name: validating-webhook-configuration
#   patch: |-
#     - op: replace
#       path: /webhooks/0/clientConfig/service/name
#       value: webhook-service
#     - op: replace
#       path: /webhooks/0/clientConfig/service/namespace
#       value: system
#     - op: replace
#       path: /webhooks/0/failurePolicy
#       value: Fail
# - target:
#     group: admissionregistration.k8s.io
#     version: v1
#     kind: MutatingWebhookConfiguration
#     name: mutating-webhook-configuration
#   patch: |-
#     - op: replace
#       path: /webhooks/0/clientConfig/service/name
#       value: webhook-service
#     - op: replace
#       path: /webhooks/0/clientConfig/service/namespace
#       value: system
#     - op: replace
#       path: /webhooks/0/failurePolicy
#       value: Fail

# [WEBHOOK] To enable webhook, uncomment all sections with [WEBHOOK] markers and [CERT] markers.
# the following config is for teaching kustomize how to do var substitution
# vars:
# - name: CERTIFICATE_NAMESPACE # namespace of the certificate CR
#   objref:
#     kind: Certificate
#     group: cert-manager.io
#     version: v1
#   fieldref:
#     fieldpath: metadata.namespace
# - name: CERTIFICATE_NAME
#   objref:
#     kind: Certificate
#     group: cert-manager.io
#     version: v1
#   fieldref:
#     fieldpath: metadata.name
# - name: SERVICE_NAMESPACE # namespace of the service
#   objref:
#     kind: Service
#     version: v1
#   fieldref:
#     fieldpath: metadata.namespace
# - name: SERVICE_NAME
#   objref:
#     kind: Service
#     version: v1
#   fieldref:
#     fieldpath: metadata.name
